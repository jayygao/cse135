<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://t.contentsquare.net/uxa/32608bf1106f4.js"></script>

    <script src="https://cdn.logr-in.com/LogRocket.min.js" crossorigin="anonymous"></script>
    <script>window.LogRocket && window.LogRocket.init('nprzds/tidydatawebsite');</script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-D23FQNFGZ4"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-D23FQNFGZ4');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Echo Form - CSE 135</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        .card {
            background: white;
            border-radius: 0.75rem;
            padding: 2rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
            margin-bottom: 1.5rem;
        }
        label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin: 1rem 0 0.3rem;
        }
        select, input, textarea {
            width: 100%;
            padding: 0.6rem 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 0.95rem;
            box-sizing: border-box;
            font-family: inherit;
            background: white;
        }
        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37,99,235,0.15);
        }
        textarea { min-height: 80px; resize: vertical; }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1rem;
        }
        @media (max-width: 600px) {
            .form-row { grid-template-columns: 1fr; }
        }
        .btn-row { margin-top: 1.5rem; display: flex; gap: 0.75rem; flex-wrap: wrap; }
        .notice {
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            color: #1e40af;
            font-size: 0.88rem;
            margin-bottom: 1rem;
        }
        .no-js-notice {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            color: #92400e;
            font-size: 0.88rem;
            margin-bottom: 1rem;
        }
        /* Hide no-js warning when JS is on */
        .js-on .no-js-notice { display: none; }
        /* Hide the JS form when JS is off, show fallback forms */
        .js-form { display: none; }
        .js-on .js-form { display: block; }
        .fallback-forms { display: block; }
        .js-on .fallback-forms { display: none; }
        .fallback-forms .card { border-left: 4px solid #2563eb; }
        .fallback-forms h3 { color: #1e40af; margin-top: 0; font-size: 1rem; }
        .fallback-forms .form-row { grid-template-columns: 1fr 1fr; }
        .lang-badge {
            display: inline-block;
            background: #eff6ff;
            color: #1e40af;
            padding: 0.2rem 0.6rem;
            border-radius: 1rem;
            font-size: 0.78rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }
        #current-endpoint {
            font-family: monospace;
            font-size: 0.85rem;
            color: #6b7280;
            background: #f3f4f6;
            padding: 0.5rem 0.75rem;
            border-radius: 0.5rem;
            margin-top: 0.75rem;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Echo Form</h1>
            <p>Test all CGI endpoints</p>
        </div>
    </header>
    <main class="container">

        <!-- No-JS warning (hidden when JS runs) -->
        <div class="no-js-notice">
            ⚠️ JavaScript is disabled. Using simplified forms below — some features (PUT, DELETE, JSON encoding) require JavaScript.
        </div>

        <!-- ================================================ -->
        <!-- JAVASCRIPT-ENABLED FORM (full features)          -->
        <!-- ================================================ -->
        <div class="js-form">
            <div class="card">
                <h2>Send a Request</h2>
                <div class="notice">
                    Select a language, HTTP method, and encoding. Fill in fields and submit. The endpoint will echo back everything it received.
                </div>

                <!-- Action is set by JS -->
                <form id="echoForm" method="GET" action="#">
                    <div class="form-row">
                        <div>
                            <label for="langSelect">Language</label>
                            <select id="langSelect">
                                <option value="python">Python</option>
                                <option value="php">PHP</option>
                                <option value="nodejs">Node.js</option>
                            </select>
                        </div>
                        <div>
                            <label for="methodSelect">HTTP Method</label>
                            <select id="methodSelect">
                                <option value="GET">GET</option>
                                <option value="POST">POST</option>
                                <option value="PUT">PUT</option>
                                <option value="DELETE">DELETE</option>
                            </select>
                        </div>
                        <div>
                            <label for="encodingSelect">Encoding</label>
                            <select id="encodingSelect">
                                <option value="urlencoded">x-www-form-urlencoded</option>
                                <option value="json">application/json</option>
                            </select>
                        </div>
                    </div>

                    <label for="field1Name">Field 1 Name</label>
                    <input type="text" id="field1Name" value="name" placeholder="field name">
                    <label for="field1Value">Field 1 Value</label>
                    <input type="text" id="field1Value" value="Jay and Jesse" placeholder="field value">

                    <label for="field2Name">Field 2 Name</label>
                    <input type="text" id="field2Name" value="course" placeholder="field name">
                    <label for="field2Value">Field 2 Value</label>
                    <input type="text" id="field2Value" value="CSE 135" placeholder="field value">

                    <label for="field3Name">Field 3 Name (optional)</label>
                    <input type="text" id="field3Name" placeholder="field name">
                    <label for="field3Value">Field 3 Value (optional)</label>
                    <input type="text" id="field3Value" placeholder="field value">

                    <div id="current-endpoint">Endpoint: loading...</div>

                    <div class="btn-row">
                        <button type="button" id="submitBtn" class="button">Send Request</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- ================================================ -->
        <!-- NO-JS FALLBACK FORMS (one per language, GET/POST only) -->
        <!-- ================================================ -->
        <div class="fallback-forms">
            <h2>Choose an endpoint to test:</h2>

            <!-- Python GET -->
            <div class="card">
                <h3>Python <span class="lang-badge">GET</span></h3>
                <form method="GET" action="cgi-bin/python/echo-python.py">
                    <div class="form-row">
                        <div>
                            <label>Name</label>
                            <input type="text" name="name" value="Jay and Jesse">
                        </div>
                        <div>
                            <label>Course</label>
                            <input type="text" name="course" value="CSE 135">
                        </div>
                    </div>
                    <div class="btn-row">
                        <button type="submit" class="button">Send GET</button>
                    </div>
                </form>
            </div>

            <!-- Python POST -->
            <div class="card">
                <h3>Python <span class="lang-badge">POST</span></h3>
                <form method="POST" action="cgi-bin/python/echo-python.py">
                    <div class="form-row">
                        <div>
                            <label>Name</label>
                            <input type="text" name="name" value="Jay and Jesse">
                        </div>
                        <div>
                            <label>Course</label>
                            <input type="text" name="course" value="CSE 135">
                        </div>
                    </div>
                    <div class="btn-row">
                        <button type="submit" class="button">Send POST</button>
                    </div>
                </form>
            </div>

            <!-- PHP GET -->
            <div class="card">
                <h3>PHP <span class="lang-badge">GET</span></h3>
                <form method="GET" action="cgi-bin/php/echo-php.php">
                    <div class="form-row">
                        <div>
                            <label>Name</label>
                            <input type="text" name="name" value="Jay and Jesse">
                        </div>
                        <div>
                            <label>Course</label>
                            <input type="text" name="course" value="CSE 135">
                        </div>
                    </div>
                    <div class="btn-row">
                        <button type="submit" class="button">Send GET</button>
                    </div>
                </form>
            </div>

            <!-- PHP POST -->
            <div class="card">
                <h3>PHP <span class="lang-badge">POST</span></h3>
                <form method="POST" action="cgi-bin/php/echo-php.php">
                    <div class="form-row">
                        <div>
                            <label>Name</label>
                            <input type="text" name="name" value="Jay and Jesse">
                        </div>
                        <div>
                            <label>Course</label>
                            <input type="text" name="course" value="CSE 135">
                        </div>
                    </div>
                    <div class="btn-row">
                        <button type="submit" class="button">Send GET</button>
                    </div>
                </form>
            </div>

            <!-- Node.js GET -->
            <div class="card">
                <h3>Node.js <span class="lang-badge">GET</span></h3>
                <form method="GET" action="/echo-nodejs">
                    <div class="form-row">
                        <div>
                            <label>Name</label>
                            <input type="text" name="name" value="Jay and Jesse">
                        </div>
                        <div>
                            <label>Course</label>
                            <input type="text" name="course" value="CSE 135">
                        </div>
                    </div>
                    <div class="btn-row">
                        <button type="submit" class="button">Send GET</button>
                    </div>
                </form>
            </div>

            <!-- Node.js POST -->
            <div class="card">
                <h3>Node.js <span class="lang-badge">POST</span></h3>
                <form method="POST" action="/echo-nodejs">
                    <div class="form-row">
                        <div>
                            <label>Name</label>
                            <input type="text" name="name" value="Jay and Jesse">
                        </div>
                        <div>
                            <label>Course</label>
                            <input type="text" name="course" value="CSE 135">
                        </div>
                    </div>
                    <div class="btn-row">
                        <button type="submit" class="button">Send POST</button>
                    </div>
                </form>
            </div>
        </div>

        <div style="text-align:center; margin-top: 2rem;">
            <a href="index.html" class="button">Back to Home</a>
        </div>
    </main>
    <footer><p>&copy; 2026 CSE 135 Team</p></footer>

    <script>
    (function() {
        // Mark body so CSS can hide/show sections
        document.body.classList.add("js-on");

        const endpoints = {
            python: "/cgi-bin/python/echo-python.py",
            php:    "/cgi-bin/php/echo-php.php",
            nodejs: "/echo-nodejs"
        };

        const langSelect     = document.getElementById("langSelect");
        const methodSelect   = document.getElementById("methodSelect");
        const encodingSelect = document.getElementById("encodingSelect");
        const submitBtn      = document.getElementById("submitBtn");
        const endpointDisplay = document.getElementById("current-endpoint");
        const form           = document.getElementById("echoForm");

        function getEndpoint() {
            return window.location.origin + endpoints[langSelect.value];
        }

        function updateEndpointDisplay() {
            endpointDisplay.textContent = "Endpoint: " + getEndpoint();
        }

        // Update display on any dropdown change
        langSelect.addEventListener("change", updateEndpointDisplay);
        methodSelect.addEventListener("change", updateEndpointDisplay);
        updateEndpointDisplay();

        // Build the payload from form fields
        function getFields() {
            const fields = {};
            const n1 = document.getElementById("field1Name").value.trim();
            const v1 = document.getElementById("field1Value").value;
            const n2 = document.getElementById("field2Name").value.trim();
            const v2 = document.getElementById("field2Value").value;
            const n3 = document.getElementById("field3Name").value.trim();
            const v3 = document.getElementById("field3Value").value;
            if (n1) fields[n1] = v1;
            if (n2) fields[n2] = v2;
            if (n3) fields[n3] = v3;
            return fields;
        }

        submitBtn.addEventListener("click", function(e) {
            e.preventDefault();
            const method   = methodSelect.value;
            const encoding = encodingSelect.value;
            const url      = getEndpoint();
            const fields   = getFields();

            // For GET, append to URL as query string
            if (method === "GET") {
                const params = new URLSearchParams(fields);
                window.location.href = url + "?" + params.toString();
                return;
            }

            // For POST/PUT/DELETE, use fetch
            let body, contentType;
            if (encoding === "json") {
                body        = JSON.stringify(fields);
                contentType = "application/json";
            } else {
                body        = new URLSearchParams(fields).toString();
                contentType = "application/x-www-form-urlencoded";
            }

            fetch(url, {
                method: method,
                headers: { "Content-Type": contentType },
                body: body
            })
            .then(res => res.text())
            .then(html => {
                // Replace the page with the echo response
                document.open();
                document.write(html);
                document.close();
            })
            .catch(err => {
                alert("Request failed: " + err.message);
            });
        });
    })();
    </script>
</body>
</html>
